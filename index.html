<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>somethingtoreport</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#0f1011" />
  <meta name="description" content="Daily news and analysis" />
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Source+Code+Pro:wght@400;500&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <style>
    :root {
      --bg:#0a0a0a; --fg:#fff; --rule:#2a2a2a; --card:#111;
      --accent:#2563eb; --accent-alt:#dc2626; --meta:#9aa0a6;
      --btn-fg:#fff;
    }
    .light {
      --bg:#ffffff; --fg:#171717; --rule:#e5e5e5;
      --card:#fafafa; --accent:#2563eb; --accent-alt:#dc2626; --meta:#666;
      --btn-fg:#fff;
    }

    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    body{
      background:var(--bg);color:var(--fg);
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      font-size: 14px;
      line-height:1.5;
      -webkit-font-smoothing:antialiased;
      min-height:100vh;
      font-weight: 400;
    }
    a{color:inherit;text-decoration:none} a:hover{opacity:.8}
    
    /* Container - Centered with more width and good margins */
    .container{
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 40px;
    }

    /* Header */
    header{
      padding:60px 0 30px;
      border-bottom:1px solid var(--rule)
    }
    header h1{
      font-family: 'Inter', sans-serif;
      font-size: 2rem;
      font-weight: 500;
      letter-spacing: -0.02em;
      margin-bottom: 0.5rem;
      text-transform: lowercase;
    }
    .header-quote{
      font-family: 'Inter', sans-serif;
      font-size: 15px;
      font-style: italic;
      line-height: 1.4;
      color: var(--meta);
      margin-bottom: 1rem;
      border-left: 2px solid var(--accent);
      padding-left: 1rem;
      max-width: 500px;
    }
    .date{
      font-family: 'Source Code Pro', monospace;
      font-size: 11px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--meta);
    }

    /* Controls */
    .controls{
      display:flex;
      justify-content: space-between;
      align-items: center;
      padding:30px 0;
      border-bottom:1px solid var(--rule);
      gap: 1rem;
    }
    
    /* Pills filter - Less blocky, more refined */
    .pills{
      display:flex;
      gap:.6rem;
      align-items:center;
      flex-wrap:wrap
    }
    .pills .label{
      font-family: 'Source Code Pro', monospace;
      font-size: 11px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--meta);
      margin-right: 0.5rem;
    }
    .pill{
      padding:.5rem 1rem;
      border-radius:8px;
      border:1px solid var(--rule);
      background:transparent;
      color:var(--fg);
      font-family: 'Source Code Pro', monospace;
      font-size: 11px;
      font-weight:500;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      cursor:pointer;
      transition: all .2s;
    }
    .pill[aria-pressed="true"]{
      background:var(--accent);
      color:var(--btn-fg);
      border-color:var(--accent);
    }

    /* Search */
    .search-container{
      display:flex;
      align-items:center;
      gap:.4rem;
    }
    .search-input{
      padding:.4rem .8rem;
      border-radius:6px;
      border:1px solid var(--rule);
      background:var(--bg);
      color:var(--fg);
      font-size:13px;
      width:0;
      opacity:0;
      transition:.3s;
      font-family: 'Inter', sans-serif;
    }
    .search-input.expanded{
      width:180px;
      opacity:1
    }
    .icon-btn{
      padding:.4rem;
      border-radius:6px;
      border:1px solid var(--rule);
      background:transparent;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition:.2s;
      color:var(--fg);
    }
    .icon-btn:hover{
      border-color:var(--accent);
    }
    .icon{
      width:1rem;
      height:1rem;
      stroke:currentColor;
      fill:none
    }

    /* Fixed Theme Toggle */
    .theme-switch{
      position:fixed;
      top: 18px;
      right: 18px;
      z-index: 10000;
    }
    .theme-switch input{
      position:absolute;
      opacity:0;
      pointer-events:none
    }
    .theme-switch label{
      position:relative;
      display:inline-flex;
      align-items:center;
      width:40px;
      height:20px;
      border-radius:10px;
      border:1px solid var(--rule);
      background:var(--card);
      cursor:pointer;
      padding:2px;
    }
    .theme-switch label::after{
      content:"";
      position:absolute;
      width:14px;
      height:14px;
      border-radius:50%;
      background:var(--fg);
      transition:transform .25s ease;
    }
    .theme-switch input:checked + label::after{
      transform:translateX(20px)
    }

    /* Section headers */
    .section-header{
      font-family: 'Inter', sans-serif;
      font-size: 12px;
      font-weight:600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      margin:35px 0 18px;
      padding-bottom:6px;
      border-bottom:1px solid var(--rule);
    }
    .section-header.analysis{
      border-bottom-color:var(--accent-alt)
    }

    .articles{
      display:flex;
      flex-direction:column;
      gap:1.2rem;
      margin:0 0 2.5rem
    }

    /* Article Cards - Better spacing and colors */
    .article{
      background:transparent;
      border:1px solid var(--rule);
      border-radius:8px;
      padding:24px;
      transition: all .2s ease;
      position: relative;
    }
    .article:hover{
      border-color:var(--accent);
      transform: translateY(-2px);
    }
    
    /* Subtle gradient borders instead of solid blocks */
    .article.news::before{
      content: '';
      position: absolute;
      left: 0;
      top: 20px;
      bottom: 20px;
      width: 3px;
      background: linear-gradient(to bottom, #10b981, #34d399);
      border-radius: 0 2px 2px 0;
    }
    
    .article.analysis::before{
      content: '';
      position: absolute;
      left: 0;
      top: 20px;
      bottom: 20px;
      width: 3px;
      background: linear-gradient(to bottom, #dc2626, #ef4444);
      border-radius: 0 2px 2px 0;
    }
    
    .article-header{
      padding:0;
      margin-bottom:1rem;
      margin-left: 8px;
    }
    .article-title{
      font-family: 'Inter', sans-serif;
      font-size:1.2rem;
      font-weight:500;
      line-height:1.4;
      margin-bottom:.6rem;
    }
    .article-body{
      padding:0;
      margin-bottom:1rem;
      margin-left: 8px;
    }
    .article-summary{
      font-size:14px;
      line-height:1.5;
      color:var(--fg);
      opacity:.9;
      margin-bottom: 0.8rem;
    }
    .article-meta{
      font-family: 'Source Code Pro', monospace;
      font-size: 11px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--meta);
      margin:.5rem 0;
      margin-left: 8px;
    }

    /* Buttons */
    .toggle-more, .open-full-btn, .source-btn{
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      padding:.5rem 1rem;
      border-radius:6px;
      border:1px solid var(--rule);
      background:transparent;
      color:var(--fg);
      font-family: 'Source Code Pro', monospace;
      font-size: 11px;
      font-weight:500;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      cursor:pointer;
      transition:all .2s;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .toggle-more:hover, .open-full-btn:hover, .source-btn:hover{
      background:var(--accent);
      color:var(--btn-fg);
      border-color:var(--accent);
    }

    /* News dropdown */
    .chev{
      transition:transform .24s ease
    }
    .chev svg{
      width:.8rem;
      height:.8rem;
      display:block
    }
    .collapsible{
      overflow:hidden;
      max-height:0;
      opacity:0;
      transition:max-height .4s ease, opacity .4s ease;
      margin-top:1rem;
      margin-left: 8px;
    }
    .collapsible.open{
      opacity:1;
    }

    /* Source link styling */
    .source-link{
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      color: var(--accent);
      font-size: 11px;
      text-decoration: none;
      margin-top: 0.5rem;
    }
    .source-link:hover{
      opacity: 0.8;
    }
    .source-link svg{
      width: 10px;
      height: 10px;
    }

    /* Footer */
    footer{
      border-top:1px solid var(--rule);
      padding:35px 0;
      text-align:center;
      font-family: 'Source Code Pro', monospace;
      font-size: 11px;
      letter-spacing: 0.06em;
      color: var(--meta);
    }

    /* Overlay — smoother open/close */
    .overlay{
      position:fixed;
      inset:0;
      background:var(--bg);
      z-index:9999;
      padding:35px 40px;
      opacity:0;
      visibility:hidden;
      pointer-events:none;
      transition:opacity .25s ease, visibility .25s ease;
    }
    .overlay.open{
      opacity:1;
      visibility:visible;
      pointer-events:auto;
    }
    .overlay-wrap{
      max-width: 1000px;
      margin: 0 auto;
      height:100%;
      overflow:auto;
    }
    .overlay-card{
      background:transparent;
      padding:0;
      opacity:0;
      transform:translateY(12px);
      transition:opacity .25s ease, transform .25s ease;
    }
    .overlay.open .overlay-card{
      opacity:1;
      transform:translateY(0);
    }
    .overlay h2{
      font-family: 'Inter', sans-serif;
      font-size:1.8rem;
      font-weight:500;
      line-height:1.3;
      margin-bottom:.8rem;
    }
    .overlay .meta{
      font-family: 'Source Code Pro', monospace;
      font-size: 11px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--meta);
      margin-bottom:1.2rem;
    }
    .overlay .content{
      font-family: 'Inter', sans-serif;
      line-height:1.6;
      font-size:14px;
    }
    .overlay .content p{
      margin:1.2rem 0;
      opacity:.9;
    }
    .overlay-lead{
      font-family:'Inter',sans-serif;
      font-size:14px;
      line-height:1.6;
      opacity:.9;
      margin:.2rem 0 1rem;
    }
    
    .overlay-close{
      display:inline-flex;
      align-items:center;
      gap:.3rem;
      background:transparent;
      color:var(--fg);
      border:1px solid var(--rule);
      border-radius:6px;
      padding:.4rem .8rem;
      cursor:pointer;
      margin-bottom:1.5rem;
      font-family: 'Source Code Pro', monospace;
      font-size: 11px;
      font-weight:500;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }
    .overlay-close:hover{
      background:var(--accent);
      color:var(--btn-fg);
      border-color:var(--accent);
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .overlay,
      .overlay-card{ transition:none; }
    }

    /* Mobile adjustments */
    @media (max-width:768px){
      .container{
        padding:0 20px;
      }
      .overlay{
        padding:35px 20px;
      }
      header{padding:35px 0 18px}
      .header-quote{
        font-size: 14px;
        padding-left: 0.8rem;
        margin-bottom: 0.8rem;
      }
      .controls{
        flex-direction: column;
        align-items: stretch;
        gap: .8rem;
      }
      .pills{
        justify-content: center;
        margin: 0 auto; /* center the group */
      }
      .pills .label{
        display:none;   /* hide “Filter:” on phones */
      }
      .search-container{
        justify-content: center;
      }
      .search-input.expanded{width:100%}
      .theme-switch{top:10px;right:10px}
      .article{
        padding:20px;
      }
    }

    @media (max-width:480px){
      .container{
        padding:0 16px;
      }
      .overlay{
        padding:35px 16px;
      }
      .header-quote{
        font-size: 13px;
        padding-left: 0.6rem;
      }
      .article{
        padding:18px;
      }
    }
  </style>

  <!-- No-flash theme -->
  <script>
    (function () {
      const saved = localStorage.getItem("mode");
      const prefers = window.matchMedia("(prefers-color-scheme: dark)").matches;
      const dark = saved ? saved === "dark" : prefers;
      document.documentElement.classList.add(dark ? "dark" : "light");
    })();
  </script>
</head>
<body>
  <div class="container">
    <header>
      <h1>somethingtoreport</h1>
      <div class="header-quote">"If the doors of perception were cleansed, every thing would appear to man as it is: Infinite."</div>
      <div class="date" id="currentDate"></div>
    </header>

    <div class="controls">
      <!-- Pills filter - LEFT SIDE -->
      <div class="pills" role="group" aria-label="Content filter">
        <span class="label">Filter:</span>
        <button class="pill" data-filter="all" aria-pressed="true">All</button>
        <button class="pill" data-filter="news" aria-pressed="false">News</button>
        <button class="pill" data-filter="analysis" aria-pressed="false">Analysis</button>
      </div>

      <!-- Search - RIGHT SIDE -->
      <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Search articles..." aria-label="Search">
        <button id="searchBtn" class="icon-btn" aria-label="Open search" title="Search">
          <svg class="icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
        </button>
      </div>
    </div>

    <main>
      <h2 class="section-header" id="newsHeader">Latest Reports</h2>
      <div id="newsArticles" class="articles"></div>

      <h2 class="section-header analysis" id="analysisHeader">Latest Analysis</h2>
      <div id="analysisArticles" class="articles"></div>

      <h3 class="section-header" id="newsEarlierHeader">Earlier Reports</h3>
      <div id="newsEarlier" class="articles"></div>

      <h3 class="section-header analysis" id="analysisEarlierHeader">Earlier Analysis</h3>
      <div id="analysisEarlier" class="articles"></div>
    </main>

    <footer>
      <p>© <span id="year"></span> somethingtoreport</p>
    </footer>
  </div>

  <!-- Fixed Theme Toggle -->
  <div class="theme-switch">
    <input type="checkbox" id="themeSwitch" aria-label="Toggle dark mode">
    <label for="themeSwitch" title="Toggle dark mode"></label>
  </div>

  <!-- Overlay -->
  <div id="overlay" class="overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="overlay-wrap">
      <div class="overlay-card">
        <button class="overlay-close" id="overlayClose">← back</button>
        <div class="meta" id="ovKind"></div>
        <h2 id="ovTitle"></h2>
        <p id="ovLead" class="overlay-lead"></p>
        <div class="meta" id="ovDate"></div>
        <div class="content" id="ovContent"></div>
      </div>
    </div>
  </div>

  <script>
    /* Utils */
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => [...document.querySelectorAll(s)];
    const pad = (n) => String(n).padStart(2,'0');
    const toYMD = (d) => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    const prettyDate = (ds) => { const [y,m,d]=ds.split('-').map(Number); return new Date(y,m-1,d).toLocaleDateString(undefined,{year:'numeric',month:'long',day:'numeric'}); };

    // Current date in header
    const now = new Date();
    $("#currentDate").textContent = now.toLocaleDateString(undefined, {weekday:'long',year:'numeric',month:'long',day:'numeric'});
    $("#year").textContent = now.getFullYear();

    /* Theme toggle */
    function applyTheme(mode){
      document.documentElement.classList.toggle("dark",  mode === 'dark');
      document.documentElement.classList.toggle("light", mode !== 'dark');
      try{ localStorage.setItem("mode", mode); }catch{}
    }
    (function initTheme(){
      var checkbox = document.getElementById('themeSwitch');
      var current = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
      applyTheme(current);
      if(checkbox){ 
        checkbox.checked = (current === 'dark');
        checkbox.addEventListener('change', function(){
          applyTheme(this.checked ? 'dark' : 'light');
        });
      }
    })();

    /* Pills filter */
    const pills = $$('.pill');
    let currentFilter = 'all';
    
    function setFilter(active){
      currentFilter = active;
      pills.forEach(b => b.setAttribute('aria-pressed', String(b.dataset.filter===active)));
      
      const show=(sel,on)=>{ const el=$(sel); if(el) el.style.display=on?'block':'none'; };
      
      if(active==='all'){
        show('#newsHeader',1); show('#newsArticles',1);
        show('#analysisHeader',1); show('#analysisArticles',1);
        show('#newsEarlierHeader',1); show('#newsEarlier',1);
        show('#analysisEarlierHeader',1); show('#analysisEarlier',1);
      } else if(active==='news'){
        show('#newsHeader',1); show('#newsArticles',1);
        show('#newsEarlierHeader',1); show('#newsEarlier',1);
        show('#analysisHeader',0); show('#analysisArticles',0);
        show('#analysisEarlierHeader',0); show('#analysisEarlier',0);
      } else {
        show('#newsHeader',0); show('#newsArticles',0);
        show('#newsEarlierHeader',0); show('#newsEarlier',0);
        show('#analysisHeader',1); show('#analysisArticles',1);
        show('#analysisEarlierHeader',1); show('#analysisEarlier',1);
      }
    }
    
    pills.forEach(b => b.addEventListener('click',()=> setFilter(b.dataset.filter)));

    /* Search */
    let currentSearch = ""; let searchOpen=false; let daysCache=[];
    const searchContainer=$(".search-container"), searchInput=$("#searchInput"), searchBtn=$("#searchBtn");
    function reRenderIfReady(){ if (typeof renderRange==='function' && Array.isArray(daysCache)) renderRange(daysCache); }
    searchBtn.addEventListener('click',(e)=>{ e.preventDefault(); searchOpen=!searchOpen;
      if(searchOpen){ searchInput.classList.add('expanded'); setTimeout(()=>searchInput.focus(),10); }
      else { searchInput.classList.remove('expanded'); if(!searchInput.value){ currentSearch=""; reRenderIfReady(); } }
    });
    searchInput.addEventListener('input',(e)=>{ currentSearch=(e.target.value||"").toLowerCase(); reRenderIfReady(); });
    document.addEventListener('click',(e)=>{ if(!searchOpen) return; if(!searchContainer.contains(e.target)){ if(!searchInput.value){ searchInput.classList.remove('expanded'); searchOpen=false; currentSearch=""; reRenderIfReady(); } } });
    function filterList(list){
      if(!currentSearch) return list||[];
      const q=currentSearch;
      return (list||[]).filter(a =>
        ((a.title||"").toLowerCase().includes(q)) ||
        ((a.summary||"").toLowerCase().includes(q)) ||
        ((a.details||"").toLowerCase().includes(q))
      );
    }

    /* Data (JSON-only) */
    const DAYS_BACK=10, MAX_CONSEC_MISSES=10;
    async function fetchJSONOrNull(url){ try{ const r=await fetch(url,{cache:'no-store'}); if(!r.ok) return null; return await r.json(); }catch{ return null; } }
    async function loadRange(daysBack=DAYS_BACK){
      const out=[]; let misses=0;
      for(let i=0;i<=daysBack;i++){
        const d=new Date(); d.setDate(d.getDate()-i);
        const ds=toYMD(d);
        const [news,analysis] = await Promise.all([
          fetchJSONOrNull(`./data/news-${ds}.json`),
          fetchJSONOrNull(`./data/analysis-${ds}.json`)
        ]);
        const has = (Array.isArray(news)&&news.length) || (Array.isArray(analysis)&&analysis.length);
        misses = has ? 0 : (misses+1);
        if(has) out.push({dateStr:ds, news:news||[], analysis:analysis||[]});
        if(misses>=MAX_CONSEC_MISSES) break;
      }
      return out;
    }

    /* UI helpers */
    function openCollapsible(el){ el.classList.add('open'); const h=el.scrollHeight; el.style.maxHeight=h+'px'; el.style.opacity='1'; }
    function closeCollapsible(el){
      el.style.maxHeight = el.scrollHeight+'px';
      requestAnimationFrame(()=>{ el.style.maxHeight='0px'; el.style.opacity='0';
        el.addEventListener('transitionend', function end(){ el.classList.remove('open'); el.removeEventListener('transitionend', end); }); });
    }

    function createCard(article, kind, dateStr){
      const el=document.createElement('article');
      el.className=`article ${kind==='analysis'?'analysis':'news'}`;
      const dateLine=prettyDate(dateStr);

      el.innerHTML=`
        <div class="article-header">
          <h3 class="article-title">${article.title}</h3>
          <div class="article-meta">${dateLine}</div>
        </div>
        <div class="article-body">
          <p class="article-summary">${article.summary||''}</p>

          ${kind==='news' ? `
            <button class="toggle-more" type="button" aria-expanded="false">
              <span class="chev" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"></path></svg>
              </span>
              <span class="label">Read more</span>
            </button>
            <div class="collapsible" aria-hidden="true">
              <div style="padding:.25rem 0 .5rem">
                <p>${article.details||''}</p>
                ${article.source ? `
                  <a href="${article.source}" class="source-link" target="_blank" rel="noopener">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                      <polyline points="15 3 21 3 21 9"></polyline>
                      <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                    Source
                  </a>
                ` : ''}
              </div>
            </div>
          ` : ``}
        </div>

        ${kind==='analysis' ? `
          <div class="article-actions">
            <button class="open-full-btn" type="button">Full analysis</button>
          </div>
        ` : ``}
      `;

      // News dropdown
      if(kind==='news'){
        const toggle=el.querySelector('.toggle-more');
        const coll=el.querySelector('.collapsible');
        const label=toggle.querySelector('.label');
        const chev=toggle.querySelector('.chev');
        toggle.addEventListener('click', ()=>{
          const open = toggle.getAttribute('aria-expanded') === 'true';
          if(open){
            toggle.setAttribute('aria-expanded','false');
            label.textContent='Read more'; chev.style.transform='rotate(0deg)';
            closeCollapsible(coll); coll.setAttribute('aria-hidden','true');
          } else {
            toggle.setAttribute('aria-expanded','true');
            label.textContent='Show less'; chev.style.transform='rotate(180deg)';
            openCollapsible(coll); coll.setAttribute('aria-hidden','false');
          }
        });
      }

      // Analysis overlay
      if(kind==='analysis'){
        const fullBtn = el.querySelector('.open-full-btn');
        fullBtn.addEventListener('click',()=>{
          openOverlay(article,'analysis',dateStr);
        });
      }

      return el;
    }

    function renderSection(list, container, headerEl, kind){
      const items = filterList(list);
      if(items.length===0){ 
        container.innerHTML=''; 
        if(headerEl) headerEl.style.display='none'; 
        return; 
      }
      if(headerEl) headerEl.style.display='block';
      container.innerHTML='';
      items.forEach(a=>container.appendChild(createCard(a,kind,a.dateStr)));
    }

    /* Overlay */
    const overlay=$("#overlay"), ovTitle=$("#ovTitle"), ovLead=$("#ovLead"), ovDate=$("#ovDate"), ovContent=$("#ovContent"), ovKind=$("#ovKind");
    function openOverlay(article, kind, dateStr){
      ovKind.textContent='Analysis';
      ovTitle.textContent=article.title||'';
      ovLead.textContent=article.summary||'';
      ovDate.textContent=prettyDate(dateStr);
      ovContent.textContent = '';
      
      let content = article.full || article.details || '';
      if (typeof content === 'string' && !content.includes('<')) {
        content = '<p>' + content + '</p>';
      }
      ovContent.innerHTML = content;

      overlay.classList.add('open'); 
      overlay.setAttribute('aria-hidden','false');
      $("#overlayClose").focus(); 
      document.body.style.overflow='hidden';
    }
    
    function closeOverlay(){ 
      overlay.classList.remove('open'); 
      overlay.setAttribute('aria-hidden','true'); 
      document.body.style.overflow=''; 
    }
    
    $("#overlayClose").addEventListener('click', closeOverlay);
    overlay.addEventListener('click',(e)=>{ if(e.target===overlay) closeOverlay(); });
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape' && overlay.classList.contains('open')) closeOverlay(); });

    /* Render newest on top + earlier below */
    function attachDate(list, dateStr){ return (list||[]).map(a=>({...a, dateStr})); }
    function renderRange(days){
      daysCache=days;
      const latest=days[0];

      const latestNews = attachDate(latest?.news||[], latest?.dateStr||'');
      const latestAnalysis = attachDate(latest?.analysis||[], latest?.dateStr||'');
      renderSection(latestNews, $("#newsArticles"), $("#newsHeader"), 'news');
      renderSection(latestAnalysis, $("#analysisArticles"), $("#analysisHeader"), 'analysis');

      const earlier=days.slice(1);
      const newsEarlierList = earlier.flatMap(d=>attachDate(d.news,d.dateStr));
      const analysisEarlierList = earlier.flatMap(d=>attachDate(d.analysis,d.dateStr));
      renderSection(newsEarlierList, $("#newsEarlier"), $("#newsEarlierHeader"), 'news');
      renderSection(analysisEarlierList, $("#analysisEarlier"), $("#analysisEarlierHeader"), 'analysis');
    }

    (async function init(){
      const days = await loadRange(DAYS_BACK);
      if(!days.length) return;
      renderRange(days);
    })();
  </script>
</body>
</html>
