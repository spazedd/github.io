<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Something to Report</title>
  <meta name="description" content="Headlines with sources, fast summaries, and a clean archive." />
  <!-- FONTS (restored) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Merriweather:wght@700;900&display=swap" rel="stylesheet">
  <script>(()=>{const m=localStorage.getItem("mode");if(m==="dark")document.documentElement.setAttribute("data-theme","dark");})();</script>

  <style>
    :root{
      /* RESTORED COLORS */
      --bg:#f7f7f5; --fg:#1f2328; --muted:#5b6270;
      --brand:#8b0000; --brand-strong:#6f0000; --link:var(--brand);
      --card:#ffffff; --ring:#e5e7eb;
      --shadow:0 14px 40px rgba(139,0,0,.08), 0 6px 20px rgba(0,0,0,.06);
      --radius:16px; --pad:clamp(14px,3vw,22px); --maxw:840px;
      --h1:clamp(28px,6vw,48px); --h3:clamp(16px,2.4vw,20px);
      --body:clamp(14px,1.9vw,16px); --small:clamp(12px,1.7vw,14px);
    }
    html[data-theme="dark"]{
      --bg:#10141c; --fg:#e8ebf0; --muted:#a6b0be;
      --card:#161d2b; --ring:#263149; --link:#ff7b73; --brand:#ff6b6b; --brand-strong:#ff8a8a;
      --shadow:0 18px 48px rgba(10,10,10,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font:400 var(--body)/1.65 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}
    a{color:var(--link);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:0 var(--pad)}

    /* top bar */
    .controls{position:sticky;top:0;z-index:60;backdrop-filter:blur(12px);background:color-mix(in oklab,var(--card) 86%,transparent);border-bottom:1px solid var(--ring);padding:10px var(--pad)}
    .controls .row{max-width:var(--maxw);margin:0 auto;display:flex;align-items:center;gap:10px}
    .search{flex:1 1 auto;display:flex;gap:8px}
    .search input{width:100%;height:42px;padding:0 14px;border:1px solid var(--ring);border-radius:12px;background:var(--card);color:var(--fg);outline:none}
    .btn{display:inline-flex;align-items:center;justify-content:center;height:42px;padding:0 14px;gap:8px;background:var(--card);color:var(--fg);border:1px solid var(--ring);border-radius:12px;cursor:pointer;font-weight:600}
    .btn:hover{box-shadow:0 10px 24px rgba(139,0,0,.12)}
    .clock{font-size:var(--small);color:var(--muted);white-space:nowrap}

    header{padding:calc(var(--pad) + 6px) 0 var(--pad);border-bottom:1px solid rgba(0,0,0,.06);background:radial-gradient(1200px 420px at 50% -220px,#fff 0,#f0f0f0 55%,#e9e9e9 100%) 0/cover,linear-gradient(120deg,rgba(139,0,0,.12),transparent)}
    html[data-theme="dark"] header{border-bottom:1px solid rgba(255,255,255,.06);background:radial-gradient(1200px 420px at 50% -220px,#1f2536 0,#151c2a 60%,#0f1420 100%) 0/cover,linear-gradient(120deg,rgba(255,107,107,.18),transparent)}
    .brand{font:900 var(--h1)/1.1 Merriweather,Georgia,serif;letter-spacing:.6px;text-transform:uppercase;margin:0 0 6px;text-align:center;color:var(--fg)}
    .dek{text-align:center;color:var(--muted);font-size:var(--body);max-width:720px;margin:0 auto}

    /* date pills */
    .dates{display:flex;gap:8px;flex-wrap:nowrap;align-items:center;margin:14px auto 0;max-width:var(--maxw);overflow:auto;padding-bottom:4px}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:8px 12px;border-radius:999px;cursor:pointer;white-space:nowrap;background:var(--card);border:1px solid var(--ring);color:var(--muted);font-size:var(--small);font-weight:700}
    .pill.active{outline:2px solid var(--brand);color:var(--fg)}
    .stamp{margin-left:auto;font-size:var(--small);color:var(--muted);flex:0 0 auto}

    /* headline banner (BREAKING) */
    .panel{margin:14px auto 0;max-width:var(--maxw);background:var(--card);color:var(--fg);border:1px solid var(--ring);border-radius:14px;box-shadow:var(--shadow);overflow:hidden}
    .panel .bar{display:flex;gap:10px;align-items:center;padding:14px 16px;border-bottom:1px dashed var(--ring);font-weight:800;letter-spacing:.3px;color:var(--brand-strong)}
    .panel .body{padding:14px 16px;font-size:var(--small);color:var(--muted)}
    .hidden{display:none !important}

    /* category accordions */
    .sections{padding:16px 0 24px}
    .cat { border:1px solid var(--ring); border-radius:14px; background:var(--card); box-shadow:var(--shadow); overflow:hidden }
    .cat + .cat { margin-top:12px }
    .cat > summary { list-style:none; display:flex; align-items:center; gap:10px; padding:14px 16px; cursor:pointer; font-weight:800; letter-spacing:.3px; color:var(--brand-strong); }
    .cat > summary::-webkit-details-marker { display:none }
    .cat[open] > summary { border-bottom:1px dashed var(--ring) }
    .cat-title { flex:1 }
    .cat-count { font-size:var(--small); color:var(--muted); background:color-mix(in oklab,var(--brand) 10%,transparent); border-radius:999px; padding:4px 10px; font-weight:700 }

    .items { padding:4px 16px 10px }
    .story{padding:10px 0;border-bottom:1px dashed var(--ring);border-radius:8px}
    .story:last-child{border-bottom:none}
    .head{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .story button.title{all:unset;cursor:pointer;color:var(--fg);font-weight:700;display:block}
    .story button.title:hover{ text-decoration:underline }
    .source{display:inline-flex;align-items:center;gap:6px;font-size:var(--small);font-weight:700;text-decoration:none;padding:4px 10px;border:1px solid var(--ring);border-radius:999px;background:var(--card)}
    .summary{display:none;margin-top:6px;color:var(--muted);font-size:var(--small)}
    .story.open{background:color-mix(in oklab,var(--brand) 6%,transparent);padding:12px;border-radius:10px}
    .story.open .summary{display:block}

    .no-results{display:none;margin:6px 0 2px;color:var(--muted);font-size:var(--small)}

    /* bottom expand-all */
    .expand-wrap{display:flex;justify-content:center;margin:16px auto 26px;max-width:var(--maxw)}
    .expand-wrap .btn{height:44px}

    /* policy table */
    .table{width:100%;border-collapse:collapse;background:var(--card);border:1px solid var(--ring);border-radius:14px;box-shadow:var(--shadow);overflow:hidden}
    .table caption{padding:12px 16px;font-weight:800;text-align:left;color:var(--brand-strong);text-transform:uppercase}
    .table th,.table td{text-align:left;padding:12px 16px;font-size:var(--body);border-bottom:1px solid var(--ring)}
    .table th{font-weight:800;background:color-mix(in oklab,var(--brand) 6%,transparent)}
    .table tr:last-child td{border-bottom:none}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:color-mix(in oklab,var(--brand) 18%,transparent);color:var(--brand);font-size:var(--small);font-weight:800;letter-spacing:.2px;text-transform:uppercase}

    footer{text-align:center;padding:22px 0 40px;color:var(--muted);font-size:var(--small)}
  </style>
</head>
<body>
  <!-- sticky controls -->
  <div class="controls">
    <div class="row">
      <div class="search" role="search">
        <input id="q" type="search" placeholder="Search headlines (title or summary)..." aria-label="Search headlines" />
        <button class="btn" id="clear">Clear</button>
      </div>
      <span class="clock" id="clock">Now â€” --:--</span>
      <button class="btn" id="darkToggle" aria-pressed="false" aria-label="Toggle dark mode">ðŸŒ™</button>
    </div>
  </div>

  <!-- header -->
  <header>
    <div class="wrap">
      <h1 class="brand">Something to Report</h1>
      <p class="dek">Daily briefings with links to original sources, mobile-first layout, inline expands, and a simple JSON workflow.</p>
    </div>
  </header>

  <!-- date pills + last updated -->
  <div class="wrap">
    <div class="dates" id="dates">
      <span class="stamp" id="stamp">Last updated --:--</span>
    </div>
  </div>

  <!-- breaking (hidden when empty) -->
  <div class="wrap">
    <section class="panel breaking hidden" aria-label="Breaking" id="breaking">
      <div class="bar" id="breakingTitle"></div>
      <div class="body" id="breakingBody"></div>
    </section>

    <!-- categories -->
    <section class="sections">
      <!-- built dynamically from JSON into <details class="cat"> blocks -->
      <div id="cats"></div>
    </section>

    <!-- bottom expand/collapse -->
    <div class="expand-wrap">
      <button class="btn" id="toggleAll" aria-pressed="false">Expand all</button>
    </div>

    <!-- policy tracker (hidden when empty) -->
    <section aria-label="Policy Tracker" id="policyWrap" class="hidden">
      <table class="table" role="table" id="policyTable">
        <caption>Policy Tracker</caption>
        <thead>
          <tr><th>Topic</th><th>Status</th><th>Last Update</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </div>

  <footer>Â© <span id="year"></span> Something to Report</footer>

  <script>
    const $=(s,el=document)=>el.querySelector(s);
    const $$=(s,el=document)=>[...el.querySelectorAll(s)];

    // --- clock + footer year
    const clock=$("#clock"), stamp=$("#stamp");
    const fmtTime=d=>d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    const tick=()=>clock.textContent=`Now â€” ${fmtTime(new Date())}`;
    tick(); setInterval(tick, 1000);
    stamp.textContent=`Last updated ${fmtTime(new Date())}`;
    $("#year").textContent=new Date().getFullYear();

    // --- dark mode
    const toggle=$("#darkToggle"), root=document.documentElement;
    const saved=localStorage.getItem("mode");
    if(saved==="dark") toggle.setAttribute("aria-pressed","true");
    toggle.addEventListener("click",()=>{
      const isDark=root.getAttribute("data-theme")==="dark";
      root.setAttribute("data-theme", isDark?"light":"dark");
      localStorage.setItem("mode", isDark?"light":"dark");
      toggle.setAttribute("aria-pressed", String(!isDark));
    });

    // --- date helpers
    const datesEl=$("#dates");
    const params=new URLSearchParams(location.search);
    const preset=params.get("date");
    const ymd=(d)=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    const label=(iso)=>{const [y,m,d]=iso.split('-');return `${m}-${d}-${y}`};

    // build 3 date pills (today, -1, -2)
    const today=new Date();
    const isoList=[0,1,2].map(n=>{const d=new Date(today); d.setDate(d.getDate()-n); return ymd(d);});
    const pills=[];
    isoList.forEach((iso,i)=>{
      const b=document.createElement('button');
      b.type='button'; b.className='pill'; b.dataset.iso=iso;
      b.textContent= i===0 ? `Latest: ${label(iso)}` : label(iso);
      datesEl.insertBefore(b, $("#stamp"));
      pills.push(b);
    });

    // state
    let currentIso = (preset && isoList.includes(preset)) ? preset : isoList[0];
    let currentData = null; // holds loaded JSON for current day

    // search
    const q=$("#q"), clearBtn=$("#clear");
    function applyTextFilter(){
      const term=q.value.trim().toLowerCase();
      $$(".cat").forEach(cat=>{
        const stories=[...cat.querySelectorAll(".story")];
        let visibleCount=0;
        stories.forEach(st=>{
          const hay = (st.querySelector('.title')?.textContent || "") + " " + (st.querySelector('.summary')?.textContent || "");
          const match = term==="" || hay.toLowerCase().includes(term);
          st.style.display = match ? "" : "none";
          if(match) visibleCount++;
        });
        const countEl=cat.querySelector('.cat-count');
        if(countEl) countEl.textContent=String(visibleCount);
        // hide whole category only if search term exists and nothing visible
        cat.style.display = (term && visibleCount===0) ? "none" : "";
      });
    }
    q.addEventListener("input", applyTextFilter);
    clearBtn.addEventListener("click", ()=>{ q.value=""; applyTextFilter(); q.focus(); });

    // expand/collapse all
    const toggleAll=$("#toggleAll");
    toggleAll.addEventListener("click", ()=>{
      const open = toggleAll.getAttribute("aria-pressed")!=="true";
      toggleAll.setAttribute("aria-pressed", String(open));
      toggleAll.textContent = open ? "Collapse all" : "Expand all";
      $$(".cat").forEach(cat=> cat.open = open);
    });

    // build categories DOM for a data object
    function renderFromData(data){
      const catsWrap=$("#cats");
      catsWrap.innerHTML="";

      // Breaking (hide if empty)
      const breakingSec=$("#breaking");
      const bTitle=$("#breakingTitle");
      const bBody=$("#breakingBody");
      if(data && data.breaking && data.breaking.title){
        bTitle.textContent = data.breaking.title || "Breaking";
        bBody.textContent = data.breaking.body || "";
        breakingSec.classList.remove("hidden");
      }else{
        breakingSec.classList.add("hidden");
      }

      // categories order
      const order = ["family","education","security","america","global","journal"];
      order.forEach(key=>{
        const items = (data && Array.isArray(data[key])) ? data[key] : [];
        const det=document.createElement('details');
        det.className="cat";
        det.open = true;

        const sum=document.createElement('summary');
        const t=document.createElement('span'); t.className='cat-title'; t.textContent=key.charAt(0).toUpperCase()+key.slice(1);
        const c=document.createElement('span'); c.className='cat-count'; c.textContent=String(items.length);
        sum.append(t,c);

        const body=document.createElement('div'); body.className='items';

        if(items.length===0){
          const p=document.createElement('div');
          p.className='no-results';
          p.textContent='No items for this date.';
          body.appendChild(p);
        }else{
          items.forEach(it=>{
            const st=document.createElement('div');
            st.className='story';
            const head=document.createElement('div'); head.className='head';
            const btn=document.createElement('button'); btn.className='title'; btn.textContent=it.title || "Untitled";
            btn.addEventListener('click', ()=> st.classList.toggle('open'));
            head.appendChild(btn);
            if(it.url){
              const a=document.createElement('a'); a.className='source'; a.href=it.url; a.target="_blank"; a.rel="noopener";
              a.textContent = it.sourceLabel || "Source â†—";
              head.appendChild(a);
            }
            const sumy=document.createElement('div'); sumy.className='summary'; sumy.textContent = it.summary || "";
            st.append(head,sumy);
            body.appendChild(st);
          });
        }

        det.append(sum,body);
        catsWrap.appendChild(det);
      });

      // policy tracker (hide when empty)
      const pwrap=$("#policyWrap");
      const tbody=$("#policyTable tbody");
      tbody.innerHTML="";
      const rows = (data && Array.isArray(data.policy)) ? data.policy : [];
      if(rows.length===0){ pwrap.classList.add("hidden"); }
      else{
        rows.forEach(r=>{
          const tr=document.createElement('tr');
          const td1=document.createElement('td'); td1.textContent=r.topic || "";
          const td2=document.createElement('td'); const b=document.createElement('span'); b.className='badge'; b.textContent=r.status || ""; td2.appendChild(b);
          const td3=document.createElement('td'); td3.textContent=r.updated || "";
          tr.append(td1,td2,td3); tbody.appendChild(tr);
        });
        pwrap.classList.remove("hidden");
      }

      // re-apply search filter on new DOM
      applyTextFilter();
    }

    // load JSON for a date
    async function loadDay(iso){
      currentIso = iso;
      // highlight pill
      $$(".pill").forEach(p=> p.classList.toggle("active", p.dataset.iso===iso));

      try{
        const res = await fetch(`./data/news-${iso}.json`, {cache:"no-store"});
        if(!res.ok) throw new Error("no json");
        const json = await res.json();
        currentData = json;
        renderFromData(json);
      }catch(e){
        // empty-day fallback
        currentData = {
          breaking:null,
          policy:[],
          family:[],education:[],security:[],america:[],global:[],journal:[]
        };
        renderFromData(currentData);
      }

      // update URL (?date=)
      const url=new URL(location.href); url.searchParams.set("date", iso); history.replaceState(null,"",url.toString());
    }

    // hook pills
    pills.forEach(p=> p.addEventListener("click", ()=> loadDay(p.dataset.iso)));

    // initial day
    loadDay(currentIso);
  </script>
</body>
</html>