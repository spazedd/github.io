<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Something to Report </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#0f1011" />
  <link rel="icon" type="image/png" href="/icons/icon-1.png">
  <link rel="apple-touch-icon" href="/icons/icon-1.png">
  <link rel="manifest" href="/manifest.webmanifest" />

  <script>
    // Prevent flash on load
    (function () {
      const saved = localStorage.getItem("mode");
      const prefers = window.matchMedia("(prefers-color-scheme: dark)").matches;
      const dark = saved ? saved === "dark" : prefers;
      document.documentElement.classList.add(dark ? "dark" : "light");
    })();
  </script>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      transition: background-color 0.4s ease, color 0.4s ease;
      background: var(--bg);
      color: var(--fg);
      position: relative;
    }

    :root {
      --bg: #0f1011;
      --fg: #ececed;
      --rule: #2a2c30;
      --card: #15161a;
      --chip: #191b1f;
      --link-underline: rgba(255, 255, 255, 0.3);
      --toggle-fg: #fff;
    }
    .light {
      --bg: #f4f5f6;
      --fg: #111;
      --rule: #ddd;
      --card: #fff;
      --chip: #fff;
      --link-underline: rgba(0, 0, 0, 0.3);
      --toggle-fg: #000;
    }

    a { color: inherit; text-decoration: none; border-bottom: 1px solid var(--link-underline); }
    a:hover { opacity: 0.9; }

    header {
      text-align: center;
      padding: 56px 16px 12px;
      border-bottom: 1px solid var(--rule);
    }
    header h1 {
      font-family: Georgia, "Times New Roman", serif;
      font-weight: 800;
      font-size: clamp(2rem, 5vw, 3rem);
    }
    header p { max-width: 860px; margin: 0.6rem auto; opacity: 0.85; }
    .time { margin-top: 0.35rem; opacity: 0.7; font-size: 0.95rem; }

    .controls {
      display: flex;
      gap: 0.6rem;
      justify-content: center;
      padding: 14px 0;
    }
    .btn {
      padding: 0.55rem 1rem;
      border-radius: 999px;
      border: 1px solid var(--rule);
      background: var(--card);
      cursor: pointer;
      font-weight: 800;
      color: inherit;
      transition: transform 0.1s ease, background 0.4s ease;
    }
    .btn:hover { transform: translateY(-1px); }

    .hero {
      border: 1px solid var(--rule);
      border-radius: 12px;
      margin: 12px 0 18px;
      background: var(--card);
      overflow: hidden;
    }
    .hero-body { padding: 16px 18px; }
    .hero-body .hed {
      font-family: Georgia, "Times New Roman", serif;
      font-weight: 800;
      font-size: clamp(1.2rem, 2.3vw, 1.6rem);
    }

    .stream { display: grid; gap: 0.9rem; margin: 20px 0 40px; }
    .card {
      border: 1px solid var(--rule);
      border-radius: 10px;
      background: var(--card);
      overflow: hidden;
      transition: background 0.4s ease;
    }
    .card-inner {
      display: grid;
      grid-template-columns: 1fr 110px;
      gap: 0.6rem;
      padding: 12px;
    }
    @media (max-width: 640px) {
      .card-inner { grid-template-columns: 1fr; }
    }
    .card-body { padding: 0.5rem 0.75rem; }
    .card-title {
      font-weight: 800;
      line-height: 1.25;
      margin-bottom: 0.3rem;
    }
    .thumb {
      height: 90px;
      background: #0a0a0b;
      border-radius: 8px;
      position: relative;
      overflow: hidden;
    }

    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      background: var(--chip);
      color: var(--toggle-fg);
      border: 1px solid var(--rule);
      border-radius: 10px;
      padding: 0.35rem 0.65rem;
      cursor: pointer;
      font-weight: 800;
      margin-top: 0.1rem;
      transition: all 0.3s ease;
    }
    .chev {
      width: 0.95rem;
      height: 0.95rem;
      stroke: currentColor;
      fill: none;
      transition: transform 0.25s ease;
    }
    .panel {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transform: translateY(6px);
      transition: max-height 0.4s ease, opacity 0.3s ease, transform 0.3s ease;
      padding: 0 18px;
    }
    .panel.open {
      max-height: 500px;
      opacity: 1;
      transform: translateY(0);
      padding: 10px 18px 12px;
    }
    .summary { margin: 0.35rem 0 0.25rem; }
    .cta {
      display: inline-block;
      margin-top: 0.3rem;
      padding: 0.38rem 0.65rem;
      border: 1px solid var(--rule);
      border-radius: 8px;
      font-weight: 800;
      font-size: 0.9rem;
    }

    footer {
      border-top: 1px solid var(--rule);
      opacity: 0.85;
      text-align: center;
      padding: 18px 0 26px;
      font-size: 0.9rem;
    }
    .backtop {
      display: inline-block;
      margin-top: 0.6rem;
      border-bottom: 1px solid var(--link-underline);
      font-weight: 800;
      cursor: pointer;
    }
  </style>
</head>
<body id="top">
  <header class="wrap">
    <h1>Something to Report</h1>
    <p>Pivotal themes shaping the future: <strong>Family</strong>, <strong>Education</strong>, <strong>Security</strong>, <strong>American Values</strong>, <strong>Global Influence</strong>, <strong>Lifestyle</strong>, <strong>Politics</strong>.</p>
    <div class="time" id="now"></div>
  </header>

  <section class="wrap">
    <div class="controls">
      <button id="expandAll" class="btn">Expand All</button>
      <button id="mode" class="btn">Dark Mode</button>
    </div>

    <article class="hero">
      <div class="hero-body">
        <div class="hed" id="heroTitle"></div>
        <p id="heroDek" class="dek" style="margin-top: .35rem"></p>
      </div>
    </article>

    <main id="stream" class="stream"></main>
  </section>

  <footer class="wrap">
    <p>Send tips: <a href="mailto:tips@somethingtoreport.com">tips@somethingtoreport.com</a> · © <span id="yr"></span> Something to Report</p>
    <a class="backtop" href="#top">Back to top ↑</a>
  </footer>

  <script>
    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => [...el.querySelectorAll(s)];
    const pad = n => String(n).padStart(2,"0");
    const toISO = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    const fmtTime = d => d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});

    const tick = () => $("#now").textContent =
      new Date().toLocaleDateString("en-US",{weekday:"long", month:"long", day:"numeric", year:"numeric"}) +
      " — " + fmtTime(new Date());
    tick(); setInterval(tick, 30000);
    $("#yr").textContent = new Date().getFullYear();

    // theme toggle
    const modeBtn = $("#mode");
    function setTheme(isDark){
      document.documentElement.classList.toggle("dark", isDark);
      document.documentElement.classList.toggle("light", !isDark);
      modeBtn.textContent = isDark ? "Light Mode" : "Dark Mode";
      localStorage.setItem("mode", isDark ? "dark" : "light");
    }
    setTheme(document.documentElement.classList.contains("dark"));
    modeBtn.addEventListener("click", ()=>setTheme(!document.documentElement.classList.contains("dark")));

    // JSON path pattern
    async function fetchNews(){
      const today = toISO(new Date());
      const url = `/data/news-${today}.json`;
      try {
        const res = await fetch(url,{cache:"no-store"});
        if(!res.ok) throw new Error();
        return res.json();
      } catch {
        return {lead:null, items:[]};
      }
    }

    function chevron(){
      const s=document.createElementNS("http://www.w3.org/2000/svg","svg");
      s.setAttribute("viewBox","0 0 24 24");
      s.classList.add("chev");
      const p=document.createElementNS("http://www.w3.org/2000/svg","path");
      p.setAttribute("d","M7 10l5 5 5-5");
      p.setAttribute("stroke","currentColor");
      p.setAttribute("stroke-width","2");
      p.setAttribute("stroke-linecap","round");
      p.setAttribute("stroke-linejoin","round");
      p.setAttribute("fill","none");
      s.appendChild(p);
      return s;
    }

    function render(data){
      const hero = data.lead;
      if(hero){ $("#heroTitle").textContent = hero.title; $("#heroDek").textContent = hero.summary; }

      const stream = $("#stream"); stream.innerHTML = "";
      data.items.forEach(item=>{
        const card = document.createElement("article");
        card.className="card";
        const inner=document.createElement("div");
        inner.className="card-inner";
        const body=document.createElement("div");
        body.className="card-body";
        const right=document.createElement("div");
        right.className="thumb";
        const title=document.createElement("div");
        title.className="card-title";
        title.textContent=item.title;

        const btn=document.createElement("button");
        btn.className="toggle";
        btn.type="button";
        btn.setAttribute("aria-expanded","false");
        btn.appendChild(chevron());
        const span=document.createElement("span");
        span.textContent="Brief";
        btn.appendChild(span);

        const panel=document.createElement("div");
        panel.className="panel";
        const summary=document.createElement("p");
        summary.className="summary";
        summary.textContent=item.summary;
        const cta=document.createElement("a");
        cta.href=item.url; cta.target="_blank"; cta.rel="noopener noreferrer";
        cta.className="cta"; cta.textContent="Source";
        panel.append(summary, cta);

        btn.addEventListener("click",()=>{
          const open=panel.classList.contains("open");
          panel.classList.toggle("open",!open);
          btn.querySelector(".chev").style.transform=!open?"rotate(180deg)":"rotate(0deg)";
          btn.setAttribute("aria-expanded",String(!open));
        });

        body.append(title, btn);
        inner.append(body,right);
        card.append(inner,panel);
        stream.append(card);
      });
    }

    $("#expandAll").addEventListener("click",()=>{
      const open=$("#expandAll").textContent.includes("Expand");
      $$(".panel").forEach(p=>p.classList.toggle("open",open));
      $$(".chev").forEach(c=>c.style.transform=open?"rotate(180deg)":"rotate(0deg)");
      $("#expandAll").textContent=open?"Collapse All":"Expand All";
    });

    (async function init(){
      const json=await fetchNews();
      render(json);
    })();

    // register SW
    if("serviceWorker" in navigator){
      window.addEventListener("load",()=>navigator.serviceWorker.register("/sw.js"));
    }
  </script>
</body>
</html>
